<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>토론방</title>
    <link rel="stylesheet" href="css/room.css">
</head>
<body>
    <div class="container">
        <!-- 헤더 -->
        <header class="room-header">
            <div class="header-content">
                <h1 class="room-title" id="roomTitle">토론방 제목</h1>
                <div class="header-actions">
                    <button class="btn-icon" id="shareBtn" title="공유">
                        <span>🔗</span>
                    </button>
                    <button class="btn-icon" id="settingsBtn" title="설정">
                        <span>⚙️</span>
                    </button>
                    <button class="btn-close" id="closeBtn">
                        <span>✕</span>
                    </button>
                </div>
            </div>
        </header>

        <!-- 메인 레이아웃: 채팅 + 사이드바 -->
        <main class="main-layout">
            <!-- 채팅 영역 (왼쪽, 항상 표시) -->
            <div class="chat-area">
                <div class="chat-container">
                    <!-- 메시지 영역 -->
                    <div class="messages-area" id="messagesArea">
                        <div class="message-list" id="messageList">
                            <!-- 메시지가 여기에 표시됩니다 -->
                            <div class="system-message">
                                <span>토론방에 입장했습니다</span>
                            </div>
                        </div>
                    </div>

                    <!-- 메시지 입력 영역 -->
                    <div class="message-input-container">
                        <div class="input-wrapper">
                            <textarea
                                class="message-input"
                                id="messageInput"
                                placeholder="메시지를 입력하세요..."
                                rows="1"
                            ></textarea>
                            <button class="btn-voice" id="voiceBtn" title="음성 입력">
                                <span id="voiceIcon">🎤</span>
                            </button>
                            <button class="btn-send" id="sendBtn">
                                <span>전송</span>
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 오른쪽 사이드바 (토글) -->
            <aside class="sidebar" id="sidebar">
                <div class="sidebar-header">
                    <h2 class="sidebar-title" id="sidebarTitle">참여자</h2>
                    <button class="btn-close-sidebar" id="closeSidebarBtn">
                        <span>✕</span>
                    </button>
                </div>

                <div class="sidebar-content">
                    <!-- 참여자 컨텐츠 -->
                    <div class="sidebar-panel" id="panel-participants">
                        <div class="participants-header">
                            <div class="participant-stats">
                                <div class="stat-item">
                                    <span class="stat-label">전체</span>
                                    <span class="stat-value" id="participantCount">0</span>
                                </div>
                                <div class="stat-item">
                                    <span class="stat-label" id="onlineCount">0명 온라인</span>
                                </div>
                            </div>
                        </div>
                        <div class="participants-list" id="participantsList">
                            <div class="empty-state">
                                <p>아직 참여자가 없습니다</p>
                            </div>
                        </div>
                        <div class="participants-stats">
                            <div class="role-stats">
                                <div class="role-stat">
                                    <span class="role-label">찬성</span>
                                    <span class="role-count" id="prosCount">0</span>
                                </div>
                                <div class="role-stat">
                                    <span class="role-label">반대</span>
                                    <span class="role-count" id="consCount">0</span>
                                </div>
                                <div class="role-stat">
                                    <span class="role-label">중립</span>
                                    <span class="role-count" id="neutralCount">0</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- AI 분석 컨텐츠 -->
                    <div class="sidebar-panel" id="panel-analysis" style="display: none;">
                        <!-- AI 분석 탭 -->
                        <div class="analysis-tabs">
                            <button class="tab-btn active" data-tab="comprehensive">종합 분석</button>
                            <button class="tab-btn" data-tab="flow">흐름 시각화</button>
                            <button class="tab-btn" data-tab="verdict">AI 판결문</button>
                        </div>

                        <!-- 탭 컨텐츠 -->
                        <div class="analysis-content">
                            <!-- 종합 분석 탭 -->
                            <div class="tab-content active" id="tab-comprehensive">
                                <div class="analysis-intro">
                                    <p>찬반 토론의 논리와 전략을 분석하여 AI가 승리팀을 판정하고 상세 분석 리포트를 생성합니다.</p>
                                </div>

                                <!-- 분석 시작 전 -->
                                <div id="analysis-start-view">
                                    <button class="btn-start-analysis" id="startAnalysisBtn">
                                        <span>📊</span>
                                        <span>AI 분석 시작하기</span>
                                    </button>
                                    <p class="analysis-hint">찬반 토론의 논리와 전략을 분석하여 AI가 승리팀을 판정하고 상세 분석 리포트를 생성합니다.</p>
                                </div>

                                <!-- 로딩 상태 -->
                                <div id="analysis-loading-view" style="display: none;">
                                    <div class="loading-spinner"></div>
                                    <p class="loading-text">AI가 토론 내용을 분석하고 있습니다...</p>
                                    <div class="skeleton-box"></div>
                                    <div class="skeleton-box"></div>
                                </div>

                                <!-- 분석 결과 -->
                                <div id="analysis-result-view" style="display: none;">
                                    <!-- AI 최종 판정 -->
                                    <div class="result-section">
                                        <h3 class="section-title">🏆 AI 최종 판정</h3>
                                        <div class="verdict-box">
                                            <div class="winner-badge" id="winnerBadge">찬성 승리</div>
                                            <p class="verdict-text" id="verdictText"></p>
                                        </div>
                                    </div>

                                    <!-- 팀별 종합 분석 -->
                                    <div class="result-section">
                                        <h3 class="section-title">⚖️ 팀별 종합 분석</h3>
                                        <div class="team-analysis">
                                            <div class="team-box team-pros" id="teamProsAnalysis">
                                                <div class="team-header">
                                                    <span class="team-badge pros-badge">찬성 팀</span>
                                                </div>
                                                <div class="team-content">
                                                    <p><strong>전략 분석:</strong> <span id="prosStrategy"></span></p>
                                                    <p><strong>핵심 논거:</strong> <span id="prosArguments"></span></p>
                                                </div>
                                            </div>
                                            <div class="team-box team-cons" id="teamConsAnalysis">
                                                <div class="team-header">
                                                    <span class="team-badge cons-badge">반대 팀</span>
                                                </div>
                                                <div class="team-content">
                                                    <p><strong>전략 분석:</strong> <span id="consStrategy"></span></p>
                                                    <p><strong>핵심 논거:</strong> <span id="consArguments"></span></p>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- 주요 발언 -->
                                    <div class="result-section">
                                        <h3 class="section-title">💬 주요 발언</h3>
                                        <div class="key-statements">
                                            <div class="statement-box statement-pros" id="keyStatementPros">
                                                <div class="statement-label">[찬]</div>
                                                <p class="statement-text"></p>
                                            </div>
                                            <div class="statement-box statement-cons" id="keyStatementCons">
                                                <div class="statement-label">[반]</div>
                                                <p class="statement-text"></p>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- 전체 참여자 개별 분석 -->
                                    <div class="result-section">
                                        <h3 class="section-title">👥 전체 참여자 개별 분석</h3>
                                        <div class="participants-analysis" id="participantsAnalysis">
                                            <!-- 동적으로 생성됨 -->
                                        </div>
                                    </div>

                                    <!-- 하단 버튼 -->
                                    <div class="analysis-actions">
                                        <button class="btn-secondary" id="reanalyzeBtn">
                                            <span>📊</span>
                                            <span>다시 분석하기</span>
                                        </button>
                                        <button class="btn-primary" id="downloadPdfBtn2">
                                            <span>📄</span>
                                            <span>PDF로 다운로드</span>
                                        </button>
                                    </div>
                                </div>
                            </div>

                            <!-- 흐름 시각화 탭 -->
                            <div class="tab-content" id="tab-flow" style="display: none;">
                                <div class="empty-state">
                                    <p>흐름 시각화 기능은 준비 중입니다.</p>
                                </div>
                            </div>

                            <!-- AI 판결문 탭 -->
                            <div class="tab-content" id="tab-verdict" style="display: none;">
                                <div class="empty-state">
                                    <p>AI 판결문 기능은 준비 중입니다.</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- AI 질문 컨텐츠 -->
                    <div class="sidebar-panel" id="panel-questions" style="display: none;">
                        <div class="questions-header">
                            <div class="timer">
                                <span class="timer-label">다음 질문까지</span>
                                <span class="timer-value" id="timeRemaining">5:00</span>
                            </div>
                        </div>
                        <div class="questions-list" id="questionsList">
                            <div class="empty-state">
                                <p>AI가 토론 주제에 대한 질문을 생성 중입니다...</p>
                            </div>
                        </div>
                    </div>
                </div>
            </aside>
        </main>

        <!-- 하단 버튼 영역 -->
        <footer class="bottom-actions">
            <button class="action-btn" id="btn-participants">
                <span class="btn-icon">👥</span>
                <span class="btn-label">참여자</span>
                <span class="btn-badge" id="participantBadge">0</span>
            </button>
            <button class="action-btn" id="btn-analysis">
                <span class="btn-icon">📊</span>
                <span class="btn-label">AI 분석</span>
            </button>
            <button class="action-btn" id="btn-questions">
                <span class="btn-timer" id="aiQuestionTimer" style="display: none;">5:00</span>
                <span class="btn-icon">🤖</span>
                <span class="btn-label">AI 질문</span>
            </button>
            <button class="action-btn" id="downloadPdfBtn">
                <span class="btn-icon">📥</span>
                <span class="btn-label">PDF</span>
            </button>
        </footer>
    </div>

    <!-- 공유 모달 -->
    <div class="modal" id="shareModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>토론방 공유</h3>
                <button class="btn-close-modal" onclick="closeShareModal()">✕</button>
            </div>
            <div class="modal-body">
                <div class="share-section">
                    <label>공유 URL</label>
                    <div class="url-input-group">
                        <input type="text" id="shortUrl" readonly>
                        <button onclick="copyUrl()">복사</button>
                    </div>
                </div>
                <div class="share-section">
                    <label>QR 코드</label>
                    <div id="qrCode"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- 입장 모달 -->
    <div class="join-modal-overlay" id="joinModal" style="display: none;">
        <div class="join-modal-box">
            <button class="join-modal-close" onclick="closeJoinModal()">✕</button>
            <h2 class="join-modal-title">토론 참여 설정</h2>
            <p class="join-modal-description">
                토론에 참여하려면 닉네임을 설정해주세요.<br>
                프로필 이미지는 자동으로 할당됩니다.
            </p>

            <div class="join-modal-field">
                <label class="join-modal-label">닉네임</label>
                <input type="text" id="joinUserName" class="join-modal-input" placeholder="사용할 닉네임" autocomplete="off">
            </div>

            <div class="join-modal-field" id="joinRoleSection" style="display: none;">
                <label class="join-modal-label">팀 선택</label>
                <div class="join-modal-radio-group" id="joinRoleRadioGroup">
                    <!-- 라디오 버튼 동적 생성 -->
                </div>
            </div>

            <button onclick="confirmJoin()" class="join-modal-button">참여하기</button>
        </div>
    </div>

    <!-- 비밀 토론방 입장 코드 모달 -->
    <div class="join-modal-overlay" id="entryCodeModal" style="display: none;">
        <div class="join-modal-box">
            <button class="join-modal-close" onclick="closeEntryCodeModal()">✕</button>
            <h2 class="join-modal-title">비밀 토론방</h2>
            <p class="join-modal-description">
                입장 코드를 입력해야 토론에 참여할 수 있습니다.
            </p>

            <div class="join-modal-field">
                <label class="join-modal-label">입장 코드</label>
                <input type="text" id="entryCodeInput" class="join-modal-input" placeholder="교사가 안내한 입장 코드를 입력하세요..." autocomplete="off">
            </div>

            <button onclick="verifyEntryCode()" class="join-modal-button">입장하기</button>
        </div>
    </div>

    <!-- Socket.io -->
    <script src="/socket.io/socket.io.js"></script>
    <!-- 메인 스크립트 -->
    <script src="js/room.js"></script>
</body>
</html>
