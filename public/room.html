<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>토론방</title>
    <link rel="stylesheet" href="css/room.css">
</head>
<body>
    <div class="container">
        <!-- 헤더 -->
        <header class="room-header">
            <div class="header-content">
                <h1 class="room-title" id="roomTitle">토론방 제목</h1>
                <div class="header-actions">
                    <button class="btn-icon" id="shareBtn" title="공유">
                        <span>🔗</span>
                    </button>
                    <button class="btn-icon" id="settingsBtn" title="설정">
                        <span>⚙️</span>
                    </button>
                    <button class="btn-close" id="closeBtn">
                        <span>✕</span>
                    </button>
                </div>
            </div>
        </header>

        <!-- 토론 상황 (접을 수 있는 영역) -->
        <div class="discussion-context" id="discussionContext">
            <div class="context-header" id="contextHeader">
                <div class="context-title">
                    <span class="context-icon">📋</span>
                    <span>토론 상황</span>
                </div>
                <button class="context-toggle" id="contextToggle">
                    <span class="toggle-icon">▼</span>
                </button>
            </div>
            <div class="context-content" id="contextContent">
                <p id="contextDescription">토론 상황이 여기에 표시됩니다.</p>
            </div>
        </div>

        <!-- 메인 레이아웃: 채팅 + 사이드바 -->
        <main class="main-layout">
            <!-- 채팅 영역 (왼쪽, 항상 표시) -->
            <div class="chat-area">
                <div class="chat-container">
                    <!-- 메시지 영역 -->
                    <div class="messages-area" id="messagesArea">
                        <div class="message-list" id="messageList">
                            <!-- 메시지가 여기에 표시됩니다 -->
                            <div class="system-message">
                                <span>토론방에 입장했습니다</span>
                            </div>
                        </div>
                    </div>

                    <!-- 메시지 입력 영역 -->
                    <div class="message-input-container">
                        <div class="input-wrapper">
                            <textarea
                                class="message-input"
                                id="messageInput"
                                placeholder="메시지를 입력하세요..."
                                rows="1"
                            ></textarea>
                            <button class="btn-voice" id="voiceBtn" title="음성 입력">
                                <img id="voiceIcon" src="/images/icons/mic-on.png" alt="microphone" class="voice-icon">
                            </button>
                            <button class="btn-send" id="sendBtn">
                                <span>전송</span>
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 오른쪽 사이드바 (토글) -->
            <aside class="sidebar" id="sidebar">
                <div class="sidebar-header">
                    <h2 class="sidebar-title" id="sidebarTitle">참여자</h2>
                    <button class="btn-close-sidebar" id="closeSidebarBtn">
                        <span>✕</span>
                    </button>
                </div>

                <div class="sidebar-content">
                    <!-- 참여자 컨텐츠 -->
                    <div class="sidebar-panel" id="panel-participants">
                        <div class="participants-header">
                            <div class="participant-stats">
                                <div class="stat-item">
                                    <span class="stat-label">전체</span>
                                    <span class="stat-value" id="participantCount">0</span>
                                </div>
                                <div class="stat-item">
                                    <span class="stat-label" id="onlineCount">0명 온라인</span>
                                </div>
                            </div>
                        </div>
                        <div class="participants-list" id="participantsList">
                            <div class="empty-state">
                                <p>아직 참여자가 없습니다</p>
                            </div>
                        </div>
                        <div class="participants-stats">
                            <div class="role-stats">
                                <div class="role-stat">
                                    <span class="role-label" id="team1Label">찬성</span>
                                    <span class="role-count" id="prosCount">0</span>
                                </div>
                                <div class="role-stat">
                                    <span class="role-label" id="team2Label">반대</span>
                                    <span class="role-count" id="consCount">0</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- AI 분석 컨텐츠 -->
                    <div class="sidebar-panel" id="panel-analysis" style="display: none;">
                        <!-- AI 분석 탭 -->
                        <div class="analysis-tabs">
                            <button class="tab-btn active" data-tab="comprehensive">종합 분석</button>
                            <button class="tab-btn" data-tab="flow">흐름 시각화</button>
                            <button class="tab-btn" data-tab="verdict">AI 판결문</button>
                        </div>

                        <!-- 탭 컨텐츠 -->
                        <div class="analysis-content">
                            <!-- 종합 분석 탭 -->
                            <div class="tab-content active" id="tab-comprehensive">
                                <div class="analysis-intro">
                                    <p>찬반 토론의 논리와 전략을 분석하여 AI가 승리팀을 판정하고 상세 분석 리포트를 생성합니다.</p>
                                </div>

                                <!-- 분석 시작 전 -->
                                <div id="analysis-start-view">
                                    <button class="btn-start-analysis" id="startAnalysisBtn">
                                        <span>📊</span>
                                        <span>AI 분석 시작하기</span>
                                    </button>
                                    <p class="analysis-hint">찬반 토론의 논리와 전략을 분석하여 AI가 승리팀을 판정하고 상세 분석 리포트를 생성합니다.</p>
                                </div>

                                <!-- 로딩 상태 -->
                                <div id="analysis-loading-view" style="display: none;">
                                    <div class="loading-spinner"></div>
                                    <p class="loading-text">AI가 토론 내용을 분석하고 있습니다...</p>
                                    <div class="skeleton-box"></div>
                                    <div class="skeleton-box"></div>
                                </div>

                                <!-- 분석 결과 -->
                                <div id="analysis-result-view" style="display: none;">
                                    <!-- AI 최종 판정 -->
                                    <div class="result-section">
                                        <h3 class="section-title">🏆 AI 최종 판정</h3>
                                        <div class="verdict-box">
                                            <div class="winner-badge" id="winnerBadge">찬성 승리</div>
                                            <p class="verdict-text" id="verdictText"></p>
                                        </div>
                                    </div>

                                    <!-- 팀별 종합 분석 -->
                                    <div class="result-section">
                                        <h3 class="section-title">⚖️ 팀별 종합 분석</h3>
                                        <div class="team-analysis">
                                            <div class="team-box team-pros" id="teamProsAnalysis">
                                                <div class="team-header">
                                                    <span class="team-badge pros-badge">찬성 팀</span>
                                                </div>
                                                <div class="team-content">
                                                    <p><strong>전략 분석:</strong> <span id="prosStrategy"></span></p>
                                                    <p><strong>핵심 논거:</strong> <span id="prosArguments"></span></p>
                                                </div>
                                            </div>
                                            <div class="team-box team-cons" id="teamConsAnalysis">
                                                <div class="team-header">
                                                    <span class="team-badge cons-badge">반대 팀</span>
                                                </div>
                                                <div class="team-content">
                                                    <p><strong>전략 분석:</strong> <span id="consStrategy"></span></p>
                                                    <p><strong>핵심 논거:</strong> <span id="consArguments"></span></p>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- 주요 발언 -->
                                    <div class="result-section">
                                        <h3 class="section-title">💬 주요 발언</h3>
                                        <div class="key-statements">
                                            <div class="statement-box statement-pros" id="keyStatementPros">
                                                <div class="statement-label">[찬]</div>
                                                <p class="statement-text"></p>
                                            </div>
                                            <div class="statement-box statement-cons" id="keyStatementCons">
                                                <div class="statement-label">[반]</div>
                                                <p class="statement-text"></p>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- 전체 참여자 개별 분석 -->
                                    <div class="result-section">
                                        <h3 class="section-title">👥 전체 참여자 개별 분석</h3>
                                        <div class="participants-analysis" id="participantsAnalysis">
                                            <!-- 동적으로 생성됨 -->
                                        </div>
                                    </div>

                                    <!-- 하단 버튼 -->
                                    <div class="analysis-actions">
                                        <button class="btn-secondary" id="reanalyzeBtn">
                                            <span>📊</span>
                                            <span>다시 분석하기</span>
                                        </button>
                                        <button class="btn-primary" id="downloadPdfBtn2">
                                            <span>📄</span>
                                            <span>PDF로 다운로드</span>
                                        </button>
                                    </div>
                                </div>
                            </div>

                            <!-- 흐름 시각화 탭 -->
                            <div class="tab-content" id="tab-flow">
                                <div class="flow-intro">
                                    <p>토론의 시간대별 흐름, 참여자 간의 상호작용, 핵심 키워드 변화를 시각적으로 분석하여 토론의 역학 관계를 한눈에 파악할 수 있도록 돕습니다.</p>
                                </div>

                                <!-- 흐름 분석 시작 전 -->
                                <div id="flow-start-view">
                                    <button class="btn-start-verdict" id="startFlowBtn">
                                        <span>📊</span>
                                        <span>AI 흐름 분석 시작하기</span>
                                    </button>
                                    <p class="verdict-hint">토론 내용을 분석하여 토론 타임라인, 참여자 통계, 흐름 트렌드를 생성합니다.</p>
                                </div>

                                <!-- 로딩 상태 -->
                                <div id="flow-loading-view" style="display: none;">
                                    <div class="loading-spinner"></div>
                                    <p class="loading-text">AI가 토론 흐름을 분석하고 있습니다...</p>
                                    <div class="skeleton-box"></div>
                                    <div class="skeleton-box"></div>
                                </div>

                                <!-- 흐름 분석 결과 -->
                                <div id="flow-result-view" style="display: none;">
                                    <!-- 토론 타임라인 -->
                                    <div class="flow-section">
                                        <h3 class="flow-section-title">📖 토론 타임라인</h3>
                                        <div id="flowTimeline" class="flow-timeline-ai"></div>
                                    </div>

                                    <!-- 차트 컨테이너 -->
                                    <div class="charts-container">
                                        <!-- 참여자별 발언 비중 (도넛 차트) -->
                                        <div class="chart-section">
                                            <h3 class="chart-title">참여자별 발언 비중</h3>
                                            <div class="chart-wrapper">
                                                <canvas id="participantChart"></canvas>
                                            </div>
                                        </div>

                                        <!-- 팀별 발언 비중 (도넛 차트) -->
                                        <div class="chart-section">
                                            <h3 class="chart-title">팀별 발언 비중</h3>
                                            <div class="chart-wrapper">
                                                <canvas id="teamChart"></canvas>
                                            </div>
                                        </div>

                                        <!-- 참여자 상호작용 (레이더 차트) -->
                                        <div class="chart-section">
                                            <h3 class="chart-title">참여자 상호작용</h3>
                                            <div class="chart-wrapper">
                                                <canvas id="interactionChart"></canvas>
                                            </div>
                                        </div>

                                        <!-- 토론 흐름 트렌드 (면적 그래프) -->
                                        <div class="chart-section full-width">
                                            <h3 class="chart-title">토론 흐름 트렌드</h3>
                                            <div class="chart-wrapper">
                                                <canvas id="trendChart"></canvas>
                                            </div>
                                        </div>

                                        <!-- 핵심 키워드 트렌드 (키워드 목록 + 면적 그래프) -->
                                        <div class="chart-section full-width">
                                            <h3 class="chart-title">핵심 키워드 트렌드</h3>
                                            <div class="chart-wrapper">
                                                <canvas id="keywordChart"></canvas>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- 하단 버튼 -->
                                    <div class="verdict-actions">
                                        <button class="btn-secondary" id="reanalyzeFlowBtn">
                                            <span>🔄</span>
                                            <span>다시 분석하기</span>
                                        </button>
                                        <button class="btn-primary" id="downloadFlowPdfBtn">
                                            <span>📄</span>
                                            <span>PDF로 다운로드</span>
                                        </button>
                                    </div>
                                </div>
                            </div>

                            <!-- AI 판결문 탭 -->
                            <div class="tab-content" id="tab-verdict">
                                <div class="verdict-intro">
                                    <p>AI가 작성한 공식 판결문을 확인하세요. (최소 10개 이상의 메시지 필요)</p>
                                </div>

                                <!-- 판결문 시작 전 -->
                                <div id="verdict-start-view">
                                    <button class="btn-start-verdict" id="startVerdictBtn">
                                        <span>⚖️</span>
                                        <span>AI 판결문 생성하기</span>
                                    </button>
                                    <p class="verdict-hint">토론 내용을 분석하여 법원 판결문 형식의 공식 문서를 생성합니다.</p>
                                </div>

                                <!-- 로딩 상태 -->
                                <div id="verdict-loading-view" style="display: none;">
                                    <div class="loading-spinner"></div>
                                    <p class="loading-text">AI가 판결문을 작성하고 있습니다...</p>
                                    <div class="skeleton-box"></div>
                                    <div class="skeleton-box"></div>
                                </div>

                                <!-- 판결문 결과 -->
                                <div id="verdict-result-view" style="display: none;">
                                    <div class="verdict-document">
                                        <div class="verdict-header">
                                            <h2>토론 판결문</h2>
                                            <p class="verdict-subtitle">AI가 분석한 토론 최종 보고서</p>
                                        </div>

                                        <!-- 서론 -->
                                        <div class="verdict-major-section">
                                            <h3 class="major-section-title"><span>📖</span> 서론</h3>

                                            <div class="verdict-section">
                                                <h4>토론 개요</h4>
                                                <p id="verdictOverview"></p>
                                            </div>

                                            <div class="verdict-section">
                                                <h4>논의 배경</h4>
                                                <p id="verdictBackground"></p>
                                            </div>

                                            <div class="verdict-section">
                                                <h4>주요 쟁점</h4>
                                                <div id="verdictIssues"></div>
                                            </div>
                                        </div>

                                        <!-- 본론 -->
                                        <div class="verdict-major-section">
                                            <h3 class="major-section-title"><span>📄</span> 본론</h3>
                                            <div id="verdictMainBody"></div>
                                        </div>

                                        <!-- 특이점 및 인사이트 -->
                                        <div class="verdict-section">
                                            <h4>특이점 및 인사이트</h4>
                                            <div id="verdictInsights"></div>
                                        </div>

                                        <!-- 결론 -->
                                        <div class="verdict-major-section">
                                            <h3 class="major-section-title"><span>⚖</span> 결론</h3>

                                            <div class="verdict-section">
                                                <h4>토론 결과 요약</h4>
                                                <p id="verdictSummary"></p>
                                            </div>

                                            <div class="verdict-section">
                                                <h4>미해결 과제 및 제언</h4>
                                                <p id="verdictRecommendations"></p>
                                            </div>

                                            <div class="verdict-section">
                                                <h4>토론의 의의</h4>
                                                <p id="verdictSignificance"></p>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- 하단 버튼 -->
                                    <div class="verdict-actions">
                                        <button class="btn-secondary" id="rewriteVerdictBtn">
                                            <span>⚖️</span>
                                            <span>다시 작성하기</span>
                                        </button>
                                        <button class="btn-primary" id="downloadVerdictPdfBtn">
                                            <span>📄</span>
                                            <span>PDF로 다운로드</span>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- AI 질문 컨텐츠 -->
                    <div class="sidebar-panel" id="panel-questions" style="display: none;">
                        <div class="questions-header">
                            <div class="timer">
                                <span class="timer-label">다음 질문까지</span>
                                <span class="timer-value" id="timeRemaining">5:00</span>
                            </div>
                        </div>
                        <div class="questions-list" id="questionsList">
                            <div class="empty-state">
                                <p>AI가 토론 주제에 대한 질문을 생성 중입니다...</p>
                            </div>
                        </div>
                    </div>
                </div>
            </aside>
        </main>

        <!-- 하단 버튼 영역 -->
        <footer class="bottom-actions">
            <button class="action-btn" id="btn-participants">
                <span class="btn-icon">👥</span>
                <span class="btn-label">참여자</span>
                <span class="btn-badge" id="participantBadge">0</span>
            </button>
            <button class="action-btn" id="btn-analysis">
                <span class="btn-icon">📊</span>
                <span class="btn-label">AI 분석</span>
            </button>
            <button class="action-btn" id="btn-questions">
                <span class="btn-timer" id="aiQuestionTimer" style="display: none;">5:00</span>
                <span class="btn-icon">🤖</span>
                <span class="btn-label">AI 질문</span>
            </button>
            <button class="action-btn" id="btn-share">
                <span class="btn-icon">🔗</span>
                <span class="btn-label">공유</span>
            </button>
        </footer>
    </div>

    <!-- 공유 모달 -->
    <div class="modal" id="shareModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>토론방 공유</h3>
                <button class="btn-close-modal" onclick="closeShareModal()">✕</button>
            </div>
            <div class="modal-body">
                <div class="share-section">
                    <label>공유 URL</label>
                    <div class="url-input-group">
                        <input type="text" id="shortUrl" readonly>
                        <button onclick="copyUrl()">복사</button>
                    </div>
                </div>
                <div class="share-section">
                    <label>QR 코드</label>
                    <div id="qrCode"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- 입장 모달 -->
    <div class="join-modal-overlay" id="joinModal" style="display: none;">
        <div class="join-modal-box">
            <button class="join-modal-close" onclick="closeJoinModal()">✕</button>
            <h2 class="join-modal-title">토론 참여 설정</h2>
            <p class="join-modal-description">
                토론에 참여하려면 닉네임을 설정해주세요.<br>
                프로필 이미지는 자동으로 할당됩니다.
            </p>

            <div class="join-modal-field">
                <label class="join-modal-label">닉네임</label>
                <input type="text" id="joinUserName" class="join-modal-input" placeholder="사용할 닉네임" autocomplete="off">
            </div>

            <div class="join-modal-field" id="joinRoleSection" style="display: none;">
                <label class="join-modal-label">팀 선택</label>
                <div class="join-modal-radio-group" id="joinRoleRadioGroup">
                    <!-- 라디오 버튼 동적 생성 (팀전 모드) -->
                </div>
            </div>

            <div class="join-modal-field" id="joinRoleDropdownSection" style="display: none;">
                <label class="join-modal-label">역할 선택</label>
                <select id="joinRoleSelect" class="join-modal-input">
                    <option value="">자신의 역할을 선택하세요</option>
                    <!-- 옵션 동적 생성 (역할 모드) -->
                </select>
            </div>

            <button onclick="confirmJoin()" class="join-modal-button">참여하기</button>
        </div>
    </div>

    <!-- 비밀 토론방 입장 코드 모달 -->
    <div class="join-modal-overlay" id="entryCodeModal" style="display: none;">
        <div class="join-modal-box">
            <button class="join-modal-close" onclick="closeEntryCodeModal()">✕</button>
            <h2 class="join-modal-title">비밀 토론방</h2>
            <p class="join-modal-description">
                입장 코드를 입력해야 토론에 참여할 수 있습니다.
            </p>

            <div class="join-modal-field">
                <label class="join-modal-label">입장 코드</label>
                <input type="text" id="entryCodeInput" class="join-modal-input" placeholder="교사가 안내한 입장 코드를 입력하세요..." autocomplete="off">
            </div>

            <button onclick="verifyEntryCode()" class="join-modal-button">입장하기</button>
        </div>
    </div>

    <!-- Socket.io -->
    <script src="/socket.io/socket.io.js"></script>
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <!-- html2canvas for screen capture -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <!-- jsPDF for PDF generation -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <!-- 메인 스크립트 -->
    <script src="js/room.js"></script>
</body>
</html>
